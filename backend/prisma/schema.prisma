generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int            @id @default(autoincrement())
  firstName       String
  lastName        String
  email           String         @unique
  phone           String?
  password        String
  role            Role           @default(student)
  status          String?        @default("pending")
  resetToken         String?   
  resetTokenExpiry   DateTime?
  refreshToken         String?   
  refreshTokenExpiresAt DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  assignmentGiven Assignment[]
  attendance      Attendance[]
  lessonCreated   Lesson[]
  liveClasses     LiveClass[]    @relation("ClassTeacher")
  messageReceived Message[]      @relation("Receiver")
  messageSent     Message[]      @relation("Sender")
  notification    Notification[]
  payments        Payment[]
  salaries        Salary[]
  subjectCreated  Subject[]      @relation("SubjectTeacher")
  submissions     Submission[]
}

model Subject {
  id          Int          @id @default(autoincrement())
  title       String
  description String?
  price       Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  teacherId   Int
  assignments Assignment[]
  lessons     Lesson[]
  liveClasses LiveClass[]
  payments    Payment[]
  teacher     User         @relation("SubjectTeacher", fields: [teacherId], references: [id])
}

model Lesson {
  id          Int      @id @default(autoincrement())
  title       String
  videoUrl    String?
  pdfUrl      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  subjectId   Int
  teacherId   Int
  description String?
  subject     Subject  @relation(fields: [subjectId], references: [id])
  teacher     User     @relation(fields: [teacherId], references: [id])
}

model Assignment {
  id          Int          @id @default(autoincrement())
  title       String
  description String?
  fileUrl     String?
  dueDate     DateTime
  createdAt   DateTime     @default(now())
  subjectId   Int
  teacherId   Int
  subject     Subject      @relation(fields: [subjectId], references: [id])
  teacher     User         @relation(fields: [teacherId], references: [id])
  submissions Submission[]
}

model Submission {
  id           Int              @id @default(autoincrement())
  fileUrl      String?
  marks        Int?
  status       AssignmentStatus @default(pending)
  assignmentId Int
  studentId    Int
  submittedAt  DateTime         @default(now())
  assignment   Assignment       @relation(fields: [assignmentId], references: [id])
  student      User             @relation(fields: [studentId], references: [id])
}

model Payment {
  id            Int           @id @default(autoincrement())
  amount        Int
  status        PaymentStatus @default(pending)
  gateway       Gateway
  transactionId String?
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
  studentId     Int
  subjectId     Int
  student       User          @relation(fields: [studentId], references: [id])
  subject       Subject       @relation(fields: [subjectId], references: [id])
}

model LiveClass {
  id         Int          @id @default(autoincrement())
  startTime  DateTime
  endTime    DateTime?
  meetingUrl String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  subjectId  Int
  teacherId  Int
  attendance Attendance[]
  subject    Subject      @relation(fields: [subjectId], references: [id])
  teacher    User         @relation("ClassTeacher", fields: [teacherId], references: [id])
}

model Attendance {
  id        Int              @id @default(autoincrement())
  status    AttendanceStatus @default(present)
  timestamp DateTime         @default(now())
  classId   Int
  studentId Int
  liveClass LiveClass        @relation(fields: [classId], references: [id])
  student   User             @relation(fields: [studentId], references: [id])
}

model Salary {
  id        Int      @id @default(autoincrement())
  amount    Int
  month     String
  status    String   @default("pending")
  createdAt DateTime @default(now())
  teacherId Int
  teacher   User     @relation(fields: [teacherId], references: [id])
}

model Notification {
  id        Int      @id @default(autoincrement())
  message   String
  createdAt DateTime @default(now())
  isRead    Boolean  @default(false)
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
}

model Message {
  id         Int      @id @default(autoincrement())
  content    String
  createdAt  DateTime @default(now())
  senderId   Int
  receiverId Int
  receiver   User     @relation("Receiver", fields: [receiverId], references: [id])
  sender     User     @relation("Sender", fields: [senderId], references: [id])
}

model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  message   String
  createdAt DateTime @default(now())
}

enum Role {
  admin
  teacher
  student
  accountant
}

enum PaymentStatus {
  pending
  paid
  failed
}

enum Gateway {
  khalti
  esewa
  stripe
  paypal
  cash
}

enum AssignmentStatus {
  submitted
  graded
  pending
}

enum AttendanceStatus {
  present
  absent
}
